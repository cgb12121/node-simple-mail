<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outbox</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { width: 600px; margin: auto; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

<div class="container">
    <h2>Inbox</h2>

    <p>Welcome, <%= user.full_name %>! [<a href="/logout">Sign Out</a>] | [<a href="/compose">Compose</a>] | [<a href="/outbox">Outbox</a>]</p>

    <table>
        <tr><th>Select</th><th>Sender</th><th>Subject</th><th>Date Received</th></tr>

        <% emails.forEach(email => { %>
            <tr data-email-id="<%= email.id %>">
                <td><input type="checkbox" class="email-checkbox"></td>
                <td><%= email.sender_name %></td>
                <td><a href="/emails/<%= email.id %>"><%= email.subject || '(no subject)' %></a></td>
                <td><%= new Date(email.created_at).toLocaleString() %></td>
            </tr>
        <% }); %>
    </table>

    <% if (pages > 1) { %>
        <div class="pagination">
            <% for (let i = 1; i <= pages; i++) { %>
                <% if (i === currentPage) { %>
                    <strong><%= i %></strong>
                <% } else { %>
                    <a href="/inbox?page=<%= i %>"><%= i %></a>
                <% } %>
            <% } %>
        </div>
    <% } %>

    <button id="deleteEmails">Delete Selected Emails</button>
</div>

<script>
    document.getElementById('deleteEmails').addEventListener('click', function() {
        const selectedEmails = Array.from(document.querySelectorAll('.email-checkbox:checked')).map(checkbox => checkbox.closest('tr').dataset.emailId);

        fetch('/delete-emails', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ emailIds: selectedEmails })
        }).then(response => {
            if (response.ok) {
                location.reload();
            }
        });
    });
</script>
